const e=new URLSearchParams(location.search);function t(e){return Math.floor(Math.random()*Math.floor(e))}window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:e.get("overlay")?"transparent":7829367,init:b,update:x,channel:e.get("channel"),username:e.get("channel"),password:e.get("oauth"),onCommand:o,onChat:n,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,a,o)=>{o&&(c=Unicorn.AddBacklay("target","target",184+t(1552),1043),c.anchor.set(.5))}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let a=0;function o(e,o,n,r,s){if(!r.broadcaster&&!r.mod||"resetparachute"!==o&&"resetdrop"!==o||location.reload(),(r.broadcaster||r.mod)&&"testdrop"===o)for(var c=0;c<50;c++)a++,f("test"+a,"test_"+a,Object.keys(l)[t(Object.keys(l).length)],i[t(i.length)]);if("drop"===o){const a=twemoji.parse(n,{assetType:"png"});!s.messageEmotes&&a.length>0?f(e,e,n,i[t(i.length)],"",a[0].url):f(e,e,n,i[t(i.length)],s.messageEmotes?Object.keys(s.messageEmotes)[0]:"")}}function n(e,t,a,o,n){}const i=["chute_green","chute_pink","chute_yellow"],l={maaya:"maaya",instafluff:"insta",avellana:"avelana",jimmy:"jimmy",dobby:"dobby",harry:"harry",hermione:"hermione",ron:"ron",voldemort:"voldemort",sammie:"sammie",vampire:"vampire",witch:"witch",zombie:"zombie",monster:"monster",elf:"elf",elfgirl:"elfgirl",snowman:"snowman",santa:"santa",claus:"claus",grinch:"grinch",snowman:"snowman"};let r,s=null,c=null,p={},y=0,d="",m={},h={};function f(e,a,o,n,i="",r=""){if(!p[e]){let y=null;if(i){if(!m[i]){m[i]=!0;var c=`https://static-cdn.jtvnw.net/emoticons/v1/${i}/2.0`;return Unicorn.Load(`emote_${i}`,c),void setTimeout(()=>{f(e,a,o,n,i,r)},500)}y=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${i}`],loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),y.endImage=`emote_${i}`,y.endScale=1.2}else if(r){if(!h[r])return h[r]=!0,Unicorn.Load(`emoji_${r}`,r),void setTimeout(()=>{f(e,a,o,n,i,r)},500);y=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${r}`],loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),y.endImage=`emoji_${r}`,y.endScale=1}else l[o]||(o=Object.keys(l)[t(Object.keys(l).length)]),y=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${o}_${e}`),loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),y.endImage=`${o}_0`,y.endScale=3;let d=Unicorn.AddBacklay("para_"+e,n,{scale:{x:3,y:3},x:50,y:0,z:50});d.scale.x=0,d.scale.y=0,d.anchor.set(.5,.9);let b=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff"});b.anchor.set(.5);let x=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700"});x.anchor.set(.5),y.restitution=1,y.friction=0,y.frictionStatic=0,y.frictionAir=0,y.torque=-5+t(10),y.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,t(24)-12,0),p[e]={parachute:d,player:y,label:b,scoreLabel:x},s&&clearTimeout(s),s=setTimeout(()=>{location.reload()},9e4)}}function b(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("target","web/assets/target.png"),Unicorn.Load("star","web/assets/star.png"),r=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),r.anchor.set(.5),i.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Object.keys(l).forEach(e=>{for(let t=0;t<10;t++){let a=l[e];Unicorn.Load(`${e}_${t}`,`web/characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:2120,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:960,y:1180,width:1920,height:200,isStatic:!0})}function x(e,t){for(var a in p)if(p[a].isLanded){let e=a===d?1:.3;p[a].end.alpha=p[a].label.alpha=e,p[a].scoreLabel.tint=p[a].label.tint=a===d?16777215:3355443,a===d?(p[a].end.zIndex=p[a].scoreLabel.zIndex=p[a].label.zIndex=9e3,p[a].label.position.x=p[a].player.position.x,p[a].label.position.y=p[a].player.position.y-80,p[a].scoreLabel.position.x=p[a].label.position.x+15,p[a].scoreLabel.position.y=p[a].label.position.y-30,p[a].label.style.fontSize=46,p[a].scoreLabel.style.fontSize=46,r.x=p[a].scoreLabel.x-p[a].scoreLabel.width/2-15,r.y=p[a].scoreLabel.y-5):(p[a].label.position.x=p[a].player.position.x,p[a].label.position.y=p[a].player.position.y-60,p[a].scoreLabel.position.y=p[a].label.position.y-30,p[a].scoreLabel.alpha=0,p[a].label.style.fontSize=40,p[a].scoreLabel.style.fontSize=40)}else{if(p[a].player.position.y>1004){p[a].isLanded=!0,p[a].parachute.scale.x=p[a].parachute.scale.y=0;let e=Unicorn.AddBacklay("end_"+a,p[a].player.endImage,p[a].player.position.x,p[a].player.position.y,{scale:{x:p[a].player.endScale,y:p[a].player.endScale}});e.anchor.set(.5),p[a].player.isStatic=!0,p[a].score=(100*Math.max(0,184-Math.abs(c.position.x-p[a].player.position.x))/184).toFixed(2),e.alpha=p[a].score>0?1:.3,p[a].end=e,p[a].score>0&&(p[a].scoreLabel.x=p[a].label.position.x,p[a].scoreLabel.y=p[a].label.position.y-30,p[a].scoreLabel.text=p[a].score),p[a].score>y&&(y=p[a].score,d=a),p[a].label.alpha=p[a].score>0?1:.3,Unicorn.RemoveObject(p[a].player.label),Unicorn.RemoveBacklay("para_"+a)}else if(p[a].player.position.y>300){Unicorn.SetVelocity(p[a].player.label,p[a].player.velocity.x,.5);let t=Math.min(3,Math.max(0,.3*(p[a].player.position.y-300)));p[a].parachute.scale.x=p[a].parachute.scale.y=t,p[a].parachute.rotation=Math.sin(p[a].player.rotationOffset+e/1e3)*Math.PI/16,p[a].player.angle=Math.sin(p[a].player.rotationOffset+e/1e3)*Math.PI/16,p[a].parachute.position.x=p[a].player.position.x,p[a].parachute.position.y=p[a].player.position.y-10}else p[a].player.position.y<-540?Unicorn.SetVelocity(p[a].player.label,p[a].player.velocity.x,10):p[a].parachute.scale.x=p[a].parachute.scale.y=0;p[a].label.position.x=p[a].player.position.x,p[a].label.position.y=p[a].player.position.y-60}}