const e=new URLSearchParams(location.search);function t(e){return Math.floor(Math.random()*Math.floor(e))}function a(e,a,n,r,i){(r.broadcaster||r.mod)&&"resetparachute"===a&&location.reload(),"drop"===a&&l(e,e,n,o[t(o.length)])}function n(e,t,a,n,o){}window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:e.get("overlay")?"transparent":7829367,init:y,update:p,channel:e.get("channel"),username:e.get("channel"),password:e.get("oauth"),onCommand:a,onChat:n,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,a,n)=>{n&&(i=Unicorn.AddBacklay("target","target",184+t(1552),1043),i.anchor.set(.5),setInterval(()=>{s<100&&(s++,l("test"+s,"test_"+s,Object.keys(r)[t(Object.keys(r).length)],o[t(o.length)]))},500))}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();const o=["chute_green","chute_pink","chute_yellow"],r={maaya:"maaya",instafluff:"insta",avellana:"avelana",jimmy:"jimmy",dobby:"dobby",harry:"harry",hermione:"hermione",ron:"ron",voldemort:"voldemort",sammie:"sammie",vampire:"vampire",witch:"witch",zombie:"zombie",monster:"monster",elf:"elf",elfgirl:"elfgirl",snowman:"snowman",santa:"santa",claus:"claus",grinch:"grinch",snowman:"snowman"};let i=null,c={};function l(e,a,n,o){if(!c[e]){r[n]||(n=Object.keys(r)[t(Object.keys(r).length)]);let i=Unicorn.AddBacklay("para_"+e,o,{scale:{x:3,y:3},x:50,y:0,z:50});i.scale.x=0,i.scale.y=0,i.anchor.set(.5,.9);let l=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${n}_${e}`),loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),s=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff"});s.anchor.set(.5),l.restitution=1,l.friction=0,l.frictionStatic=0,l.frictionAir=0,l.torque=-5+t(10),l.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,t(24)-12,0),c[e]={parachute:i,player:l,label:s,character:n}}}let s=0;function y(){Unicorn.Load("target","web/assets/target.png"),o.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Object.keys(r).forEach(e=>{for(let t=0;t<10;t++){let a=r[e];Unicorn.Load(`${e}_${t}`,`web/characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:2120,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:960,y:1180,width:1920,height:200,isStatic:!0})}function p(e,t){for(var a in c)if(!c[a].isLanded){if(c[a].player.position.y>1004){c[a].isLanded=!0,c[a].parachute.scale.x=c[a].parachute.scale.y=0,Unicorn.AddBacklay("end_"+a,`${c[a].character}_0`,c[a].player.position.x,c[a].player.position.y,{scale:{x:3,y:3}}).anchor.set(.5),c[a].player.isStatic=!0,c[a].score=100*Math.max(0,184-Math.abs(i.position.x-c[a].player.position.x))/184,console.log(a,c[a].score),Unicorn.RemoveObject(c[a].player.label),Unicorn.RemoveBacklay("para_"+a)}else if(c[a].player.position.y>300){Unicorn.SetVelocity(c[a].player.label,c[a].player.velocity.x,.5);let t=Math.min(3,Math.max(0,.3*(c[a].player.position.y-300)));c[a].parachute.scale.x=c[a].parachute.scale.y=t,c[a].parachute.rotation=Math.sin(c[a].player.rotationOffset+e/1e3)*Math.PI/16,c[a].player.angle=Math.sin(c[a].player.rotationOffset+e/1e3)*Math.PI/16,c[a].parachute.position.x=c[a].player.position.x,c[a].parachute.position.y=c[a].player.position.y-10}else c[a].player.position.y<-540?Unicorn.SetVelocity(c[a].player.label,c[a].player.velocity.x,10):c[a].parachute.scale.x=c[a].parachute.scale.y=0;c[a].label.position.x=c[a].player.position.x,c[a].label.position.y=c[a].player.position.y-60}}