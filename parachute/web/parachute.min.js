let e={},a={};new URLSearchParams(location.search);function t(e){return Math.floor(Math.random()*Math.floor(e))}window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:x,update:g,channel:a.channel,username:a.oauth?a.channel:void 0,password:a.oauth,onCommand:r,onChat:i,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(n,r,i)=>{i&&function(){if(p=Unicorn.AddBacklay("target","target",184+t(1552),1043),p.anchor.set(.5),"show"===a.clouds)for(let n=0;n<11;n++){o++;let n=e.clouds[t(e.clouds.length)],r=Unicorn.AddOverlay("cloud_"+o,n,t(1920),t(500),{scale:{x:3,y:3}});r.alpha=a.overlay?.5:.9,r.anchor.set(.5),r.speed=.01+.1*Math.random(),r.zIndex=r.speed,b.push(r)}a.hideTilDrop&&(b.forEach(e=>e.visible=!1),p.visible=!1)}()}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();let o=0,n=!0;function r(r,i,l,s,c){if(!s.broadcaster&&!s.mod||"resetparachute"!==i&&"resetdrop"!==i||location.reload(),(s.broadcaster||s.mod)&&"testdrop"===i)for(var y=0;y<50;y++)o++,u("test"+o,"test_"+o,Object.keys(e.characters)[t(Object.keys(e.characters).length)],e.parachutes[t(e.parachutes.length)]);if("drop"===i){n&&a.hideTilDrop&&(n=!1,b.forEach(e=>e.visible=!0),p.visible=!0);const o=twemoji.parse(l,{assetType:"png"});!c.messageEmotes&&o.length>0?u(r,r,l,e.parachutes[t(e.parachutes.length)],"",o[0].url):u(r,r,l,e.parachutes[t(e.parachutes.length)],c.messageEmotes?Object.keys(c.messageEmotes)[0]:"")}}function i(e,a,t,o,n){}let l,c=null,p=null,y={},d=0,h="",f={},m={},b=[];function u(a,o,n,r,i="",l=""){if(!y[a]){let p=null;if(i){if(!f[i]){f[i]=!0;var s=`https://static-cdn.jtvnw.net/emoticons/v1/${i}/2.0`;return Unicorn.Load(`emote_${i}`,s),void setTimeout(()=>{u(a,o,n,r,i,l)},500)}p=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${i}`],loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),p.endImage=`emote_${i}`,p.endScale=1.2}else if(l){if(!m[l])return m[l]=!0,Unicorn.Load(`emoji_${l}`,l),void setTimeout(()=>{u(a,o,n,r,i,l)},500);p=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${l}`],loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),p.endImage=`emoji_${l}`,p.endScale=1}else e.characters[n]||(n=e.playable[Math.floor(e.playable.length*Math.random())]),p=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${n}_${e}`),loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),p.endImage=`${n}_0`,p.endScale=3;let d=Unicorn.AddBacklay("para_"+a,r,{scale:{x:3,y:3},x:50,y:0,z:50});d.scale.x=0,d.scale.y=0,d.anchor.set(.5,.9);let h=Unicorn.AddText("name_"+a,o,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff",lineJoin:"round",stroke:"#000000",strokeThickness:6});h.anchor.set(.5);let b=Unicorn.AddText(a+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});b.anchor.set(.5),p.restitution=1,p.friction=0,p.frictionStatic=0,p.frictionAir=0,p.torque=-5+t(10),p.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+a,t(24)-12,0),y[a]={parachute:d,player:p,label:h,scoreLabel:b},c&&clearTimeout(c),c=setTimeout(()=>{location.reload()},9e4)}}function x(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`assets/${e.bg}.png`),!a.overlay){var t=Unicorn.AddBacklay("map","map",0,0);t.scale.x=3,t.scale.y=3}Unicorn.Load("target","web/assets/target.png"),Unicorn.Load("star","web/assets/star.png"),l=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),l.anchor.set(.5),e.parachutes.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Object.keys(e.characters).forEach(a=>{for(let t=0;t<10;t++){let o=e.characters[a];Unicorn.Load(`${a}_${t}`,`web/characters/${a}/${o}_front/${o}_front${t+1}.png`)}}),e.clouds.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:2120,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:960,y:1180,width:1920,height:200,isStatic:!0})}function g(e,o){for(var n in y)if(y[n].isLanded){let e=n===h?1:.3;y[n].end.alpha=y[n].label.alpha=e,y[n].scoreLabel.tint=y[n].label.tint=n===h?16777215:3355443,n===h?(y[n].end.zIndex=y[n].scoreLabel.zIndex=y[n].label.zIndex=9e3,y[n].label.position.x=y[n].player.position.x,y[n].label.position.y=y[n].player.position.y-80,y[n].scoreLabel.position.x=y[n].label.position.x+15,y[n].scoreLabel.position.y=y[n].label.position.y-30,y[n].label.style.fontSize=46,y[n].scoreLabel.style.fontSize=46,l.x=y[n].scoreLabel.x-y[n].scoreLabel.width/2-15,l.y=y[n].scoreLabel.y-5):(y[n].label.position.x=y[n].player.position.x,y[n].label.position.y=y[n].player.position.y-60,y[n].scoreLabel.position.y=y[n].label.position.y-30,y[n].scoreLabel.alpha=0,y[n].label.style.fontSize=40,y[n].scoreLabel.style.fontSize=40)}else{if(y[n].player.position.y>1004){y[n].isLanded=!0,y[n].parachute.scale.x=y[n].parachute.scale.y=0;let e=Unicorn.AddBacklay("end_"+n,y[n].player.endImage,y[n].player.position.x,y[n].player.position.y,{scale:{x:y[n].player.endScale,y:y[n].player.endScale}});if(e.anchor.set(.5),y[n].player.isStatic=!0,y[n].score=100*Math.max(0,184-Math.abs(p.position.x-y[n].player.position.x))/184,e.alpha=y[n].score>0?1:.3,y[n].end=e,y[n].score>0&&(y[n].scoreLabel.x=y[n].label.position.x,y[n].scoreLabel.y=y[n].label.position.y-30,y[n].scoreLabel.text=y[n].score.toFixed(2)),y[n].score>d&&(d=y[n].score,h=n),y[n].label.alpha=y[n].score>0?1:.3,Unicorn.RemoveObject(y[n].player.label),Unicorn.RemoveBacklay("para_"+n),a.messageFormat){let e=a.messageFormat.replace("USERNAME",s.name).replace("POINTS",s.score);ComfyJS.Say(e)}}else if(y[n].player.position.y>300){Unicorn.SetVelocity(y[n].player.label,y[n].player.velocity.x,.5);let a=Math.min(3,Math.max(0,.3*(y[n].player.position.y-300)));y[n].parachute.scale.x=y[n].parachute.scale.y=a,y[n].parachute.rotation=Math.sin(y[n].player.rotationOffset+e/1e3)*Math.PI/16,y[n].player.angle=Math.sin(y[n].player.rotationOffset+e/1e3)*Math.PI/16,y[n].parachute.position.x=y[n].player.position.x,y[n].parachute.position.y=y[n].player.position.y-10}else y[n].player.position.y<-540?Unicorn.SetVelocity(y[n].player.label,y[n].player.velocity.x,10):y[n].parachute.scale.x=y[n].parachute.scale.y=0;y[n].label.position.x=y[n].player.position.x,y[n].label.position.y=y[n].player.position.y-60}b.forEach((e,a)=>{e.x-=o*e.speed,e.x+e.width/2<=0&&(e.x=1920+e.width/2,e.y=t(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}