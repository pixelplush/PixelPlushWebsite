let e="Pixel Parachute",t={},a={};function o(e){return Math.floor(Math.random()*Math.floor(e))}function n(){let t=Object.keys(d).length;fetch(`https://api.instafluff.tv:8082/report?game=${e}&channel=${a.channel}&players=${t}&persist=true`).then(e=>e.json()).then(e=>{0===e.status&&console.log("Error:",e.message)})}window.setupGame=function(o,n,r){e=o,t=n,a=r,a.clouds=void 0===a.clouds||null===a.clouds?!a.overlay:a.clouds},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:g,update:v,channel:a.channel,username:a.oauth?a.channel:void 0,password:a.oauth,onCommand:l,onChat:s,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,i,l)=>{l&&(function(){if(y=Unicorn.AddBacklay("target","target",184+o(1552),1033,{scale:{x:2,y:2}}),y.anchor.set(.5),a.clouds)for(let e=0;e<11;e++){r++;let e=t.clouds[o(t.clouds.length)],n=Unicorn.AddOverlay("cloud_"+r,e,o(1920),o(500),{scale:{x:3,y:3}});n.alpha=a.overlay?.5:.9,n.anchor.set(.5),n.speed=.01+.1*Math.random(),n.zIndex=n.speed,b.push(n)}a.hideTilDrop&&(b.forEach(e=>e.visible=!1),y.visible=!1)}(),setInterval(()=>{n()},6e4),n())}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let r=0,i=!0;function l(e,n,l,s,c){if(!s.broadcaster&&!s.mod||"resetparachute"!==n&&"resetdrop"!==n||location.reload(),(s.broadcaster||s.mod)&&"testdrop"===n)for(var p=0;p<50;p++)r++,x("test"+r,"test_"+r,c.userColor||"#ffffff",Object.keys(t.characters)[o(Object.keys(t.characters).length)],t.parachutes[o(t.parachutes.length)]);if("drop"===n){i&&a.hideTilDrop&&(i=!1,b.forEach(e=>e.visible=!0),y.visible=!0);const n=twemoji.parse(l,{assetType:"png"});!c.messageEmotes&&n.length>0?x(e,e,c.userColor||"#ffffff",l,t.parachutes[o(t.parachutes.length)],"",n[0].url):x(e,e,c.userColor||"#ffffff",l,t.parachutes[o(t.parachutes.length)],c.messageEmotes?Object.keys(c.messageEmotes)[0]:"")}}function s(e,t,a,o,n){}let c,p=null,y=null,d={},f=0,h="",u={},m={},b=[];function x(e,a,n="#ffffff",r,i,l="",s=""){if(!d[e]){let f=null,h=tinycolor(n);if(l){if(!u[l]){u[l]=!0;var c=`https://static-cdn.jtvnw.net/emoticons/v1/${l}/2.0`;return Unicorn.Load(`emote_${l}`,c),void setTimeout(()=>{x(e,a,n,r,i,l,s)},500)}f=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${l}`],loop:!0}},x:o(1920),y:-100-o(50),z:100,radius:36}),f.endImage=`emote_${l}`,f.endScale=1.2}else if(s){if(!m[s])return m[s]=!0,Unicorn.Load(`emoji_${s}`,s),void setTimeout(()=>{x(e,a,n,r,i,l,s)},500);f=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${s}`],loop:!0}},x:o(1920),y:-100-o(50),z:100,radius:36}),f.endImage=`emoji_${s}`,f.endScale=1}else if(t.characters[r]||(r=t.playable[Math.floor(t.playable.length*Math.random())]),f=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${r}_${e}`),loop:!0}},x:o(1920),y:-100-o(50),z:100,radius:36}),f.endImage=`${r}_0`,f.endScale=3,"boybear"===r||"girlbear"===r){var y=PIXI.utils.string2hex(h.brighten(50).toHexString());f.animations.front.tint=y}let b=Unicorn.AddBacklay("para_"+e,i,{scale:{x:3,y:3},x:50,y:0,z:50});b.scale.x=0,b.scale.y=0,b.anchor.set(.5,.9);let g=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:n,lineJoin:"round",stroke:h.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});g.anchor.set(.5);let v=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});v.anchor.set(.5),f.restitution=1,f.friction=0,f.frictionStatic=0,f.frictionAir=0,f.torque=-5+o(10),f.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,o(24)-12,0),d[e]={parachute:b,player:f,label:g,scoreLabel:v},p&&clearTimeout(p),p=setTimeout(()=>{location.reload()},9e4)}}function g(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`web/assets/${t.bg}.png`),!a.overlay){var e=Unicorn.AddBacklay("map","map",0,0);e.scale.x=3,e.scale.y=3}Unicorn.Load("target",`web/assets/${t.target}.png`),Unicorn.Load("star","web/assets/star.png"),c=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),c.anchor.set(.5),t.parachutes.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Object.keys(t.characters).forEach(e=>{for(let a=0;a<10;a++){let o=t.characters[e];Unicorn.Load(`${e}_${a}`,`web/characters/${e}/${o}_front/${o}_front${a+1}.png`)}}),t.clouds.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:2120,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:960,y:1180,width:1920,height:200,isStatic:!0})}function v(e,t){for(var n in d)if(d[n].isLanded){let e=n===h?1:.3;d[n].end.alpha=d[n].label.alpha=e,d[n].scoreLabel.tint=d[n].label.tint=n===h?16777215:3355443,n===h?(d[n].end.zIndex=d[n].scoreLabel.zIndex=d[n].label.zIndex=9e3,d[n].label.position.x=d[n].player.position.x,d[n].label.position.y=d[n].player.position.y-80,d[n].scoreLabel.position.x=d[n].label.position.x+15,d[n].scoreLabel.position.y=d[n].label.position.y-30,d[n].label.style.fontSize=46,d[n].scoreLabel.style.fontSize=46,c.x=d[n].scoreLabel.x-d[n].scoreLabel.width/2-15,c.y=d[n].scoreLabel.y-5):(d[n].label.position.x=d[n].player.position.x,d[n].label.position.y=d[n].player.position.y-60,d[n].scoreLabel.position.y=d[n].label.position.y-30,d[n].scoreLabel.alpha=0,d[n].label.style.fontSize=40,d[n].scoreLabel.style.fontSize=40)}else{if(d[n].player.position.y>984){d[n].isLanded=!0,d[n].parachute.scale.x=d[n].parachute.scale.y=0;let e=Unicorn.AddBacklay("end_"+n,d[n].player.endImage,d[n].player.position.x,d[n].player.position.y,{scale:{x:d[n].player.endScale,y:d[n].player.endScale}});if(d[n].player.animations&&(e.tint=d[n].player.animations.front.tint),e.anchor.set(.5),d[n].player.isStatic=!0,d[n].score=100*Math.max(0,184-Math.abs(y.position.x-d[n].player.position.x))/184,e.alpha=d[n].score>0?1:.3,d[n].end=e,d[n].score>0&&(d[n].scoreLabel.x=d[n].label.position.x,d[n].scoreLabel.y=d[n].label.position.y-30,d[n].scoreLabel.text=d[n].score.toFixed(2),a.messageFormat)){let e=a.messageFormat.replace("USERNAME",n).replace("POINTS",d[n].score.toFixed(2));setTimeout(()=>{ComfyJS.Say(e)},5e3)}d[n].score>f&&(f=d[n].score,h=n),d[n].label.alpha=d[n].score>0?1:.3,Unicorn.RemoveObject(d[n].player.label),Unicorn.RemoveBacklay("para_"+n)}else if(d[n].player.position.y>300){Unicorn.SetVelocity(d[n].player.label,d[n].player.velocity.x,.5);let t=Math.min(3,Math.max(0,.3*(d[n].player.position.y-300)));d[n].parachute.scale.x=d[n].parachute.scale.y=t,d[n].parachute.rotation=Math.sin(d[n].player.rotationOffset+e/1e3)*Math.PI/16,d[n].player.angle=Math.sin(d[n].player.rotationOffset+e/1e3)*Math.PI/16,d[n].parachute.position.x=d[n].player.position.x,d[n].parachute.position.y=d[n].player.position.y-10}else d[n].player.position.y<-540?Unicorn.SetVelocity(d[n].player.label,d[n].player.velocity.x,10):d[n].parachute.scale.x=d[n].parachute.scale.y=0;d[n].label.position.x=d[n].player.position.x,d[n].label.position.y=d[n].player.position.y-60}b.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=1920+e.width/2,e.y=o(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}