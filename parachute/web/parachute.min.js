const e=new URLSearchParams(location.search);function t(e){return Math.floor(Math.random()*Math.floor(e))}function a(e,a,n,i,r){(i.broadcaster||i.mod)&&"resetparachute"===a&&location.reload(),"drop"===a&&c(e,e,n,o[t(o.length)])}function n(e,t,a,n,o){}window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:e.get("overlay")?"transparent":7829367,init:s,update:y,channel:e.get("channel"),username:e.get("channel"),password:e.get("oauth"),onCommand:a,onChat:n,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,a,n)=>{n&&setInterval(()=>{l<100&&(l++,c("test"+l,"test_"+l,Object.keys(i)[t(Object.keys(i).length)],o[t(o.length)]))},500)}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();const o=["chute_green","chute_pink","chute_yellow"],i={maaya:"maaya",instafluff:"insta",avellana:"avelana",jimmy:"jimmy",dobby:"dobby",harry:"harry",hermione:"hermione",ron:"ron",voldemort:"voldemort",sammie:"sammie",vampire:"vampire",witch:"witch",zombie:"zombie",monster:"monster",elf:"elf",elfgirl:"elfgirl",snowman:"snowman",santa:"santa",claus:"claus",grinch:"grinch",snowman:"snowman"};let r={};function c(e,a,n,o){if(!r[e]){i[n]||(n=Object.keys(i)[t(Object.keys(i).length)]);let c=Unicorn.AddBacklay("para_"+e,o,{scale:{x:3,y:3},x:50,y:0,z:50});c.scale.x=0,c.scale.y=0,c.anchor.set(.5,.9);let l=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${n}_${e}`),loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),s=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff"});s.anchor.set(.5),l.restitution=1,l.friction=0,l.frictionStatic=0,l.frictionAir=0,l.torque=5+t(5),l.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,t(24)-12,0),r[e]={parachute:c,player:l,label:s,character:n}}}let l=0;function s(){o.forEach(e=>Unicorn.Load(e,`assets/${e}.png`)),Object.keys(i).forEach(e=>{for(let t=0;t<10;t++){let a=i[e];Unicorn.Load(`${e}_${t}`,`characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:2120,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:960,y:1180,width:1920,height:200,isStatic:!0})}function y(e,t){for(var a in r)if(!r[a].isLanded){if(r[a].player.position.y>1034){r[a].isLanded=!0,r[a].parachute.scale.x=r[a].parachute.scale.y=0,Unicorn.AddBacklay("end_"+a,`${r[a].character}_0`,r[a].player.position.x,r[a].player.position.y,{scale:{x:3,y:3}}).anchor.set(.5),r[a].player.isStatic=!0,Unicorn.RemoveObject(r[a].player.label),Unicorn.RemoveBacklay("para_"+a)}else if(r[a].player.position.y>200){Unicorn.SetVelocity(r[a].player.label,r[a].player.velocity.x,1);let t=Math.min(3,Math.max(0,.3*(r[a].player.position.y-200)));r[a].parachute.scale.x=r[a].parachute.scale.y=t,r[a].parachute.rotation=Math.sin(r[a].player.rotationOffset+e/1e3)*Math.PI/16,r[a].player.angle=Math.sin(r[a].player.rotationOffset+e/1e3)*Math.PI/16,r[a].parachute.position.x=r[a].player.position.x,r[a].parachute.position.y=r[a].player.position.y-10}else r[a].player.position.y<-540?Unicorn.SetVelocity(r[a].player.label,r[a].player.velocity.x,10):r[a].parachute.scale.x=r[a].parachute.scale.y=0;r[a].label.position.x=r[a].player.position.x,r[a].label.position.y=r[a].player.position.y-60}}