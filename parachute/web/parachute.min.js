const e=new URLSearchParams(location.search);function t(e){return Math.floor(Math.random()*Math.floor(e))}window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:e.get("overlay")?"transparent":7829367,init:d,update:h,channel:e.get("channel"),username:e.get("channel"),password:e.get("oauth"),onCommand:o,onChat:n,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,a,o)=>{o&&(c=Unicorn.AddBacklay("target","target",184+t(1552),1043),c.anchor.set(.5))}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let a=0;function o(e,o,n,l,c){if(!l.broadcaster&&!l.mod||"resetparachute"!==o&&"resetdrop"!==o||location.reload(),(l.broadcaster||l.mod)&&"testdrop"===o)for(var s=0;s<50;s++)a++,m("test"+a,"test_"+a,Object.keys(i)[t(Object.keys(i).length)],r[t(r.length)]);if("drop"===o){const a=twemoji.parse(n,{assetType:"png"});!c.messageEmotes&&a.length>0?m(e,e,n,r[t(r.length)],"",a[0].url):m(e,e,n,r[t(r.length)],c.messageEmotes?Object.keys(c.messageEmotes)[0]:"")}}function n(e,t,a,o,n){}const r=["chute_green","chute_pink","chute_yellow"],i={maaya:"maaya",instafluff:"insta",avellana:"avelana",jimmy:"jimmy",dobby:"dobby",harry:"harry",hermione:"hermione",ron:"ron",voldemort:"voldemort",sammie:"sammie",vampire:"vampire",witch:"witch",zombie:"zombie",monster:"monster",elf:"elf",elfgirl:"elfgirl",snowman:"snowman",santa:"santa",claus:"claus",grinch:"grinch",snowman:"snowman"};let l=null,c=null,s={},p={},y={};function m(e,a,o,n,r="",c=""){if(!s[e]){let h=null;if(r){if(!p[r]){p[r]=!0;var d=`https://static-cdn.jtvnw.net/emoticons/v1/${r}/2.0`;return Unicorn.Load(`emote_${r}`,d),void setTimeout(()=>{m(e,a,o,n,r,c)},500)}h=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${r}`],loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),h.endImage=`emote_${r}`,h.endScale=1.2}else if(c){if(!y[c])return y[c]=!0,Unicorn.Load(`emoji_${c}`,c),void setTimeout(()=>{m(e,a,o,n,r,c)},500);h=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${c}`],loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),h.endImage=`emoji_${c}`,h.endScale=1}else i[o]||(o=Object.keys(i)[t(Object.keys(i).length)]),h=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${o}_${e}`),loop:!0}},x:t(1920),y:-100-t(50),z:100,radius:36}),h.endImage=`${o}_0`,h.endScale=3;let f=Unicorn.AddBacklay("para_"+e,n,{scale:{x:3,y:3},x:50,y:0,z:50});f.scale.x=0,f.scale.y=0,f.anchor.set(.5,.9);let u=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff"});u.anchor.set(.5),h.restitution=1,h.friction=0,h.frictionStatic=0,h.frictionAir=0,h.torque=-5+t(10),h.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,t(24)-12,0),s[e]={parachute:f,player:h,label:u},l&&clearTimeout(l),l=setTimeout(()=>{location.reload()},9e4)}}function d(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("target","web/assets/target.png"),r.forEach(e=>Unicorn.Load(e,`web/assets/${e}.png`)),Object.keys(i).forEach(e=>{for(let t=0;t<10;t++){let a=i[e];Unicorn.Load(`${e}_${t}`,`web/characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:2120,y:0,width:400,height:2160,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:960,y:1180,width:1920,height:200,isStatic:!0})}function h(e,t){for(var a in s)if(!s[a].isLanded){if(s[a].player.position.y>1004){s[a].isLanded=!0,s[a].parachute.scale.x=s[a].parachute.scale.y=0;let e=Unicorn.AddBacklay("end_"+a,s[a].player.endImage,s[a].player.position.x,s[a].player.position.y,{scale:{x:s[a].player.endScale,y:s[a].player.endScale}});e.anchor.set(.5),s[a].player.isStatic=!0,s[a].score=100*Math.max(0,184-Math.abs(c.position.x-s[a].player.position.x))/184,e.alpha=s[a].score>0?1:.3,s[a].label.alpha=s[a].score>0?1:.3,Unicorn.RemoveObject(s[a].player.label),Unicorn.RemoveBacklay("para_"+a)}else if(s[a].player.position.y>300){Unicorn.SetVelocity(s[a].player.label,s[a].player.velocity.x,.5);let t=Math.min(3,Math.max(0,.3*(s[a].player.position.y-300)));s[a].parachute.scale.x=s[a].parachute.scale.y=t,s[a].parachute.rotation=Math.sin(s[a].player.rotationOffset+e/1e3)*Math.PI/16,s[a].player.angle=Math.sin(s[a].player.rotationOffset+e/1e3)*Math.PI/16,s[a].parachute.position.x=s[a].player.position.x,s[a].parachute.position.y=s[a].player.position.y-10}else s[a].player.position.y<-540?Unicorn.SetVelocity(s[a].player.label,s[a].player.velocity.x,10):s[a].parachute.scale.x=s[a].parachute.scale.y=0;s[a].label.position.x=s[a].player.position.x,s[a].label.position.y=s[a].player.position.y-60}}